<?xml version="1.0" encoding="ISO-8859-1"?>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

<document>

 <properties>
  <title>Build-Test Framework</title>
  <author email="dev@harmony.apache.org">Harmony Documentation Team</author>
 </properties>

 <body>

<section name="Build-Test Framework">
<p>
    The
    <a href="http://svn.apache.org/viewvc/harmony/enhanced/buildtest/">
      <i>build-test framework</i></a> is a simple configuration of
    <a href="http://cruisecontrol.sourceforge.net/"><code>CruiseControl</code></a>,
    a framework for continuous build process. It also includes all the
    necessary support to simplify installation.
</p>

<p>
    Currently, the framework does the following distinct tasks, in order,
    and only when code changes in the repository:</p>
    <ol>
        <li>Update the source for the class library from SVN</li>
        <li>Get any new dependencies needed for building the class library</li>
        <li>Build and test the class library</li>
        <li>Update the source for the DRLVM from SVN</li>
        <li>Get and build any new dependencies needed for DRLVM</li>
        <li>Build and test the DRLVM</li>
    </ol>
</section>
   <section name="Setup and Configuration">

  <subsection name="Prerequisites"> 

    <p>You need to obtain and install the same <a href="../../quickhelp_contributors.html">tools</a>, 
    as for building the Apache Harmony
    components.</p>
  </subsection>

  <subsection name="Setup">
        <p>
       Get the <code>/harmony/enhanced/buildtest/</code> part of the Apache
       Harmony project via <code>zip</code> or <code>tgz</code> files. You also can 
       check it out from the project Subversion repository:</p>

    <pre>svn co http://svn.apache.org/repos/asf/harmony/enhanced/buildtest/trunk</pre>

    <p>
       With Java, Ant and SVN installed, change into the <code>buildtest/trunk</code>
       directory and type:
    </p>

    <pre>ant setup</pre>

    <p>
       This command fetches <code>CruiseControl</code>, sets it up with the Apache Harmony
       configuration, and checks out the software for building and testing 
       from Apache Harmony.
    </p>

    <p>
       To run the tests successfully, you need to do the
       following manual steps for now:
    </p>

    <ol>
      <li>
         Build the classlib to create the <code>deploy/jdk</code> tree in classlib, 
         first fetching the dependencies:
        <pre>cd cc/projects/classlib/trunk
ant fetch-depends
ant</pre>
      </li>
      <li>
         Get the appropriate IBM J9 VM for your platform (this will go
         away when DRLVM is good enough):

         <pre>http://www-128.ibm.com/developerworks/java/jdk/harmony/index.html</pre>
       </li>

        <li>
         Unpack the above-fetched J9 distribution into the <code>jdk</code> directory (as
         the distro assumes it is dropped into the<code>jdk</code> directory):

        <pre>cd cc/projects/classlib/trunk/deploy/jdk/
tar zxf Harmony-vme-linux.IA32-v4.tar.gz</pre>
        </li>

    </ol>
  </subsection>
  <subsection name="Starting CruiseControl">

    <p>
        To start the system, type the following command in 
        <code>buildtest/trunk</code>: 
    </p>

     <pre>ant</pre>

    <p>The given command launches <code>CruiseControl</code> with the full test set. 
    To check status, point your browser to:</p>

   <pre>http://localhost:8080/</pre>
  </subsection>
</section>
 </body>
 </document>





