<?xml version="1.0" encoding="UTF-8"?>

<!--

    Copyright 2006 The Apache Software Foundation

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

<document>

 <properties>
  <title>Building the Apache Harmony Classlib</title>
  <author email="harmony-dev@incubator.apache.org">Harmony Documentation Team</author>
 </properties>

<body>

<section name="Building the Apache Harmony Class Library">
	<p>
		The Harmony class library code is a subset of the Java(tm) SE 1.5 APIs currently
		being developed in the <a href="http://incubator.apache.org/harmony/">
		Apache Harmony project</a>. This page describes how to build the class library code,
		and includes links to pre-built versions of the code.
	</p>
	<p>
		<i>Standard Disclaimer:</i>
		Apache Harmony is an effort undergoing incubation at the Apache Software
		Foundation (ASF). Incubation is required of all newly accepted projects until
		a further review indicates that the infrastructure, communications, and
		decision making process have stabilized in a manner consistent with other
		successful ASF projects. While incubation status is not necessarily a
		reflection of the completeness or stability of the code, it does indicate
		that the project has yet to be fully endorsed by the ASF. 
	</p>

<subsection name="Building from source">
	<p>
		The Harmony class library code is available for Microsoft(tm) Windows(tm) and
		Linux(tm) operating systems, on x86 processors only.
	</p>
	<p>
		The following prerequisite tools must be available on the path in order to build
		the Harmony classlib code from source.
		<ul>
			<li>All platforms require Subversion client, Apache Ant, Java 1.5 JDK
				(i.e. including javac) in addition
				<ul>
	    			<li>Windows platforms : Microsoft Visual C++, and nmake. </li>
	    			<li>Linux platforms : Gnu gcc, and Gnu make.</li>
	    		</ul>
		    </li>
		</ul>

        <i><b>Please Note :</b></i> Please use <a href="http://ant.apache.org">Ant</a>
        version 1.6.5 or later - earlier versions
        (ex. 1.6.2) have been reported to handle the .svn directory incorractly, resulting
        in double-scanning file systems during build.

    </p>
	<p>
		You can build the latest version of the class library code in three simple steps:
		<ol>
			<li>Download classlib source from Harmony subversion repository
			<pre>svn checkout -r HEAD https://svn.apache.org/repos/asf/incubator/harmony/enhanced/classlib/trunk Harmony</pre>
			</li>
			<li>Change to main make directory, and run the default ant script target
			<pre>cd Harmony/make
ant</pre>
			</li>
			<li><a href="#Obtaining_a_VM">Get a VM suitable for running the class library
				code</a>, and
				expand it over the top of the Harmony directory (so that the 'jdk'
				directories line-up)
			<pre>unzip &lt;path_to_vm_zip&gt; -d ../.. (on Windows)</pre>
			<pre>tar xzf &lt;path_to_vm_tarball&gt; --directory ../.. (on Linux)</pre>
			</li>
		</ol>
	</p>
	<p>
		Now you are ready to <a href="#Running_Java">run some Java applications</a>!
	</p>
</subsection>

<subsection name="Using pre-built binaries">
	<p>
		Pre-built binaries are available as a convenience for people who don't
		have ready access to the prerequisite tools.
	</p>
	<p>
		These are <i>snapshot</i> builds, not official releases of the project.
		Snapshots are builds of the repository at a given revision.  The file
		name of each snapshot build indicates the revision of the code repository,
		and the platform on which it was built.
	</p>
	<p>
		You can use a pre-built binaries in three easy steps:
		<ol>
			<li>Obtain a pre-built class library snapshot for your platform from the
				<a href="http://cvs.apache.org/dist/incubator/harmony/snapshots/">
				Harmony snapshot site</a>.</li>
			<li><a href="#Obtaining_a_VM">Obtain a compatible virtual machine</a> and
				put it into the same directory as the class library code.</li>
   			<li>Simply expand the classlib archive and the VM archive from the
   				same directory. They should create a subdirectory called &quot;Harmony&quot;
   				with files from each archive overlaid (so that the
   				'Harmony/deploy/jdk'-s line-up).</li>
   				On Windows:
   				<pre>unzip &lt;path_to_classlib_zip&gt; (on Windows)
unzip &lt;path_to_vm_zip&gt;</pre>
				On Linux:
				<pre>tar xzf &lt;path_to_classlib_tarball&gt; (on Linux)
tar xzf &lt;path_to_vm_tarball&gt;</pre>
		</ol>
	</p>
	<p>
		Now you are ready to <a href="#Running_Java">run some Java applications</a>!
	</p>
</subsection>


<subsection name="Obtaining a compatible VM">
<a name="Obtaining_a_VM"/>
	<p>
		The Harmony class library code interfaces to a VM through a virtual machine interface
		defined in the Harmony project.
	</p>
	<p>
		There is a VM that implements this interface available from the
		<a href="http://www-128.ibm.com/developerworks/java/jdk/harmony/index.html">
		IBM DeveloperWorks site</a>.
		<em>The IBM VM is not open source</em> (although the VM interface itself is).
	</p>
	<p>
		Once you have obtained the IBM VM you should have one of the following files:
		<ul>
			<li>on Windows &quot;Harmony-vme-win.IA32-v3.zip&quot;</li>
			<li>on Linux &quot;Harmony-vme-linux.IA32-v3.tar.gz&quot;</li>
		</ul>
	</p>
</subsection>

<subsection name="Running Java applications">
<a name="Running_Java"/>
	<p>
		Ensure that the <code>JAVA_HOME</code> environment variable is unset, or pointing
		to the <code>Harmony/deploy/jdk/jre</code> directory.
	</p>
	<p>
		Run Java applications as usual, using the launcher in Harmony/deploy/jdk/jre/bin:
		<pre>> jre\bin\java -showversion -jar helloworld.jar
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
Hello world!
</pre>
	</p>
</subsection>

</section>
</body>
</document>