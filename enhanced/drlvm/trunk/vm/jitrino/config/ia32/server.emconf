# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
# 
#     http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

#EM configuration for 'server' mode of Jitrino
chains=chain1,chain2
chain1.jits=JET_CLINIT
chain2.jits=SD1_OPT,SD2_OPT

chain1.filter=+::<clinit>
chain1.filter=-

JET_CLINIT.file=jitrino
SD1_OPT.file=jitrino
SD2_OPT.file=jitrino

# Edge profiler and recompilation parameters
EDGE_PROF.profilerType=EDGE_PROFILER
EDGE_PROF.entryThreshold=40000
EDGE_PROF.backedgeThreshold=150000
EDGE_PROF.tbsTimeout=10
EDGE_PROF.tbsInitialTimeout=0

VALUE_PROF.profilerType=VALUE_PROFILER
VALUE_PROF.vpalgo=TNV_FIRST_N
VALUE_PROF.vpSteadySize=4
SD1_OPT.genProfile=EDGE_PROF,VALUE_PROF
SD2_OPT.useProfile=EDGE_PROF,VALUE_PROF

#options for JIT

-XDjit.JET_CLINIT.path=


-XDjit.SD1_OPT.path=opt_init,translator,optimizer,hir2lir,codegen

-XDjit.SD1_OPT.path.optimizer=ssa,simplify,dce,uce,vp_instrument,devirt_virtual,edge_instrument,dessa,statprof,markglobals
-XDjit.SD1_OPT.path.devirt_virtual=devirt
-XDjit.SD1_OPT.path.codegen=lock_method,bbp,btr,gcpoints,cafl,dce1,i8l,api_magic,early_prop,peephole,itrace-,native,constraints,dce2,regalloc,spillgen,layout,copy,rce+,stack,break-,iprof-,peephole,emitter!,si_insts,gcmap,info,unlock_method
-XDjit.SD1_OPT.path.dce1=cg_dce
-XDjit.SD1_OPT.path.dce2=cg_dce
-XDjit.SD1_OPT.path.regalloc=bp_regalloc1,bp_regalloc2
-XDjit.SD1_OPT.path.bp_regalloc1=bp_regalloc
-XDjit.SD1_OPT.path.bp_regalloc2=bp_regalloc

-XDjit.SD1_OPT.arg.codegen.dce1.early=yes
-XDjit.SD1_OPT.arg.codegen.regalloc.bp_regalloc1.regs=ALL_GP
-XDjit.SD1_OPT.arg.codegen.regalloc.bp_regalloc2.regs=ALL_XMM
-XDjit.SD1_OPT.arg.codegen.btr.insertCMOVs=no
-XDjit.SD1_OPT.arg.codegen.btr.removeConstCompare=yes


-XDjit.SD2_OPT.path=opt_init,translator,optimizer,hir2lir,codegen

-XDjit.SD2_OPT.path.optimizer=ssa,simplify,dce,uce,devirt_virtual,edge_annotate,unguard,devirt_intf,inline,uce,purge,simplify,dce,uce,lazyexc,so2-,simplify,dce,uce,escape,inline_helpers,purge,simplify,uce,dce,dessa,statprof,peel,ssa,hvn,simplify,dce,uce,lower,dce,uce,memopt,reassoc,dce,uce,hvn,dce,uce,abcd,dce,uce,gcm,dessa,statprof,markglobals
-XDjit.SD2_OPT.path.codegen=lock_method,bbp,btr,gcpoints,cafl,dce1,i8l,api_magic,early_prop,peephole,itrace-,native,constraints,dce2,regalloc,spillgen,layout,copy,rce+,stack,break-,iprof-,peephole,emitter!,si_insts,gcmap,info,unlock_method
-XDjit.SD2_OPT.path.dce1=cg_dce
-XDjit.SD2_OPT.path.dce2=cg_dce
-XDjit.SD2_OPT.path.regalloc=bp_regalloc1,bp_regalloc2
-XDjit.SD2_OPT.path.bp_regalloc1=bp_regalloc
-XDjit.SD2_OPT.path.bp_regalloc2=bp_regalloc

#devirt configuration
-XDjit.SD2_OPT.path.devirt_virtual=devirt
-XDjit.SD2_OPT.path.devirt_intf=devirt
-XDjit.SD2_OPT.arg.optimizer.devirt_intf.devirt_intf_calls=true
-XDjit.SD2_OPT.arg.optimizer.devirt_intf.devirt_virtual_calls=false

#inliner configuration
-XDjit.SD2_OPT.SD2_OPT_inliner_pipeline.filter=-
-XDjit.SD2_OPT.SD2_OPT_inliner_pipeline.path=ssa,simplify,dce,uce,devirt_virtual,edge_annotate,unguard,devirt_intf
-XDjit.SD2_OPT.arg.optimizer.inline.pipeline=SD2_OPT_inliner_pipeline
-XDjit.SD2_OPT.arg.optimizer.inline.connect_early=false
#devirt configuration for inliner pipeline
-XDjit.SD2_OPT.SD2_OPT_inliner_pipeline.path.devirt_virtual=devirt
-XDjit.SD2_OPT.SD2_OPT_inliner_pipeline.path.devirt_intf=devirt
-XDjit.SD2_OPT.SD2_OPT_inliner_pipeline.arg.devirt_intf.devirt_intf_calls=true
-XDjit.SD2_OPT.SD2_OPT_inliner_pipeline.arg.devirt_intf.devirt_virtual_calls=false

#helper inliner configuration
-XDjit.SD2_OPT.SD2_OPT_helper_inliner_pipeline.filter=-
-XDjit.SD2_OPT.SD2_OPT_helper_inliner_pipeline.path=ssa
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.pipeline=SD2_OPT_helper_inliner_pipeline

-XDjit.SD2_OPT.arg.optimizer.inline_helpers.newObj=on
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.newObj_className=org/apache/harmony/drlvm/gc_cc/GCHelper
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.newObj_methodName=alloc
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.newObj_hotnessPercent=1

-XDjit.SD2_OPT.arg.optimizer.inline_helpers.newArray=on
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.newArray_className=org/apache/harmony/drlvm/gc_cc/GCHelper
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.newArray_methodName=allocArray
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.newArray_hotnessPercent=1

-XDjit.SD2_OPT.arg.optimizer.inline_helpers.objMonEnter=on
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.objMonEnter_className=org/apache/harmony/drlvm/thread/ThreadHelper
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.objMonEnter_methodName=monitorEnterUseReservation
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.objMonEnter_hotnessPercent=1

-XDjit.SD2_OPT.arg.optimizer.inline_helpers.objMonExit=on
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.objMonExit_className=org/apache/harmony/drlvm/thread/ThreadHelper
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.objMonExit_methodName=monitorExit
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.objMonExit_hotnessPercent=1

-XDjit.SD2_OPT.arg.optimizer.inline_helpers.ldInterface=on
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.ldInterface_className=org/apache/harmony/drlvm/VMHelperFastPath
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.ldInterface_methodName=getInterfaceVTable3
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.ldInterface_hotnessPercent=1

-XDjit.SD2_OPT.arg.optimizer.inline_helpers.checkCast=on
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.checkCast_className=org/apache/harmony/drlvm/VMHelperFastPath
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.checkCast_methodName=checkCast
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.checkCast_hotnessPercent=1

-XDjit.SD2_OPT.arg.optimizer.inline_helpers.instanceOf=on
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.instanceOf_className=org/apache/harmony/drlvm/VMHelperFastPath
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.instanceOf_methodName=instanceOf
-XDjit.SD2_OPT.arg.optimizer.inline_helpers.instanceOf_hotnessPercent=1

-XDjit.SD2_OPT.arg.codegen.dce1.early=yes
-XDjit.SD2_OPT.arg.codegen.regalloc.bp_regalloc1.regs=ALL_GP
-XDjit.SD2_OPT.arg.codegen.regalloc.bp_regalloc2.regs=ALL_XMM
-XDjit.SD2_OPT.arg.codegen.btr.insertCMOVs=no
-XDjit.SD2_OPT.arg.codegen.btr.removeConstCompare=yes
-XDjit.arg.codegen.emitter.align=4


#system properties
-Djava.compiler=server

#GC magics support
-Dvm.components.gc_cc.startupclass=org.apache.harmony.drlvm.gc_cc.GCHelper
-XDvm.component.classpath.gc_cc=gc_cc.jar

#TM properties
-Dvm.components.hythr.startupclass=org.apache.harmony.drlvm.thread.ThreadHelper
-XDvm.component.classpath.hythr=hythr.jar

#VM helpers
-Dvm.components.vmcore1.startupclass=org.apache.harmony.drlvm.VMHelper
-Dvm.components.vmcore2.startupclass=org.apache.harmony.drlvm.VMHelperFastPath

