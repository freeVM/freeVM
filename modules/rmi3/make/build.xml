<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
    Copyright 2005-2006 The Apache Software Foundation or its licensors, as applicable

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.

    See the License for the specific language governing permissions and
    limitations under the License.
-->
<!--
Author:  Alexei Y. Zakharov, Vasily Zakharov
Version: $Revision: 1.129.8.6 $
-->

<project name="rmi" basedir="." default="jar">

    <!-- determine the OS -->
    <condition property="platform.name" value="win32">
        <os family="Windows"/> 
    </condition>
    <condition property="platform.name" value="linux">
        <and>
            <os name="linux"/> 
            <os family="unix"/> 
        </and>
    </condition>

    <!-- needed for pathConvert tags -->
    <condition property="os.family" value="windows">
        <os family="Windows"/> 
    </condition>
    <condition property="os.family" value="unix">
        <os family="unix"/> 
    </condition>

    <!-- additional environment -->
    <property environment="env"/>
    <property file="external_tools.properties"/>

    <!-- common properties -->
    <property name="src.dir" value="../src/common/javasrc"/>

    <!-- root dir for all build files -->
    <property name="build.path" value="../build"/>

    <property name="classes.dir" value="${build.path}/classes"/>
    <property name="deploy.dir" value="${build.path}/deploy"/>
    <property name="jar.dir" value="${deploy.dir}/jre/lib/boot"/>
    <property name="jar.name" value="classes.jar"/>
    <path id="compile.classpath">
        <pathelement path="${classes.dir}"/>
    </path>

    <property name="tst.src.dir" value="../test/common/unit"/>
    <property name="tst.classes.dir" value="${build.path}/tests"/>
    <property name="tst.jar.dir" value="${build.path}/jars"/>
    <property name="tst.reports.dir" value="${build.path}/test-reports"/>
    <path id="tst.classpath">
        <pathelement path="${classes.dir}"/>
        <pathelement path="${tst.classes.dir}"/>
        <pathelement location="${junit.path}"/>
    </path>

    <import file="build-rmi.xml"/>

    <patternset id="src.list">
        <patternset refid="src.list.rmi"/>
    </patternset>

    <patternset id="tst.src.list">
        <patternset refid="tst.src.list.rmi"/>
    </patternset>

    <!-- common targets -->

    <target name="compile.common" description="Compile sources">
        <mkdir dir="${classes.dir}"/>
        <javac srcdir="${src.dir}"
               sourcepath=""
               destdir="${classes.dir}"
               source="1.4"
               deprecation="on"
               classpathref="compile.classpath"
               debug="on">
               <patternset refid="src.list"/>
        </javac>
    </target>

    <target name="tst.compile.common" description="Compile tests">
        <mkdir dir="${tst.classes.dir}"/>
        <javac srcdir="${tst.src.dir}"
               sourcepath=""
               destdir="${tst.classes.dir}"
               source="1.4"
               deprecation="on"
               classpathref="tst.classpath"
               debug="on">
               <patternset refid="tst.src.list"/>
        </javac>
    </target>

    <target name="jar.common" description="Build JAR archive">
        <mkdir dir="${jar.dir}"/>
        <jar destfile="${jar.dir}/${jar.name}">
             <fileset dir="${classes.dir}">
                <patternset refid="classes.list"/>
             </fileset>
        </jar>
    </target>

    <target name="tst.jar.common" description="Build JAR with tests">
        <mkdir dir="${tst.jar.dir}"/>
        <jar destfile="${tst.jar.dir}/${tst.jar.name}">
             <fileset dir="${tst.classes.dir}">
                <patternset refid="tst.classes.list"/>
             </fileset>
        </jar>
    </target>

    <!-- global targets -->

    <target name="clean" description="Delete all generated files">
        <delete dir="${classes.dir}" failonerror="false"/>
        <delete dir="${deploy.dir}" failonerror="false"/>
        <delete dir="${tst.classes.dir}" failonerror="false"/>
        <delete dir="${tst.jar.dir}" failonerror="false"/>
        <delete dir="${tst.reports.dir}" failonerror="false"/>
        <delete dir="log" failonerror="false"/>
    	<delete><fileset dir="." includes="junit*.properties"/></delete>
    </target>

    <target name="compile" description="Compile sources">
        <antcall target="compile.rmi"/>
    </target>

    <target name="tst.compile" description="Compile tests">
        <antcall target="tst.compile.rmi"/>
    </target>

    <target name="jar" description="Build JAR archive">
        <antcall target="jar.rmi"/>
    </target>

    <target name="tst.jar" description="Build JAR with tests">
        <antcall target="tst.jar.rmi"/>
    </target>

    <target name="tests.run" description="run all tests">
        <antcall target="test.rmi"/>
    </target>

</project>
