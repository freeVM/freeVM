<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<!--
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->


<!-- start the processing -->
    <!-- ====================================================================== -->
    <!-- GENERATED FILE, DO NOT EDIT, EDIT THE XML FILE IN xdocs INSTEAD! -->
    <!-- Main Page Section -->
    <!-- ====================================================================== -->
    <html>
        <head>
            <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>

                                                    <meta name="author" value="Harmony Documentation Team">
            <meta name="email" value="dev@harmony.apache.org">
            
           
            
            
            
            
            
            <title>Apache Harmony - Compatibility goals in the Apache Harmony Classlib</title>

                        
                        
        <link rel="stylesheet" type="text/css" href="../../site.css"/>
        </head>

        <body>        
            <table  width="100%" cellspacing="0">
                <!-- TOP IMAGE -->
                <tr>
                    <td align='LEFT'>
                    <table><tr><td>
                    <td>
<a href="http://harmony.apache.org/"><img  src="../../images/harmony-logo-new.png" alt="Apache Harmony" /></a>
</td>
</td>
                    </td></tr></table>
                    </td>
                    <td align='RIGHT'>
                    <a href="http://www.apachecon.com/2007/EU/index.html">
                    <img src="http://www.apache.org/ads/ApacheCon/2007-europe-234x60.png"
                    	alt="ApacheCon Europe 2007" /></a>                    
                    </td>
                </tr>
            </table>
            <table width="100%" cellspacing="4">
                <tr><td colspan="2">
                    <hr noshade="" size="1"/>
                </td></tr>

                <tr>
                    <!-- LEFT SIDE NAVIGATION -->
                    <td class="menuItem" width="20%" nowrap="true">

                    <!-- special ACon Logo - leave here for next time
                    <a href="http://www.us.apachecon.com/">
                        <img src="http://www.apache.org/ads/ApacheCon/2007-europe-125x125.png"
                             alt="ApacheCon Europe 2007" />
                    </a> -->

                   <!-- regular menu -->

                    
    <!-- ============================================================ -->

                <p class="menuItem"><strong>General</strong></p>
        <ul>
                    <li class="menuItem">    <a href="../../index.html">Home</a>
</li>
           
                        
                    <li class="menuItem">    <a href="../../license.html">License</a>
</li>
           
                        
                    <li class="menuItem">    <a href="http://apache.org">ASF</a>
</li>
           
                        
                    <li class="menuItem">    <a href="../../contribution_policy.html">Contribution Policy</a>
</li>
           
                        
                    <li class="menuItem">    <a href="../../downloads.html">Downloads</a>
</li>
           
                        
                    <li class="menuItem">    <a href="../../faq.html">FAQ</a>
</li>
           
                        
        
        </ul>
            <p class="menuItem"><strong>Community</strong></p>
        <ul>
                    <li class="menuItem">    <a href="../../get-involved.html">Get Involved</a>
</li>
           
                        
                    <li class="menuItem">    <a href="../../contributors.html">Who we are</a>
</li>
           
                        
                    <li class="menuItem">    <a href="../../mailing.html">Mailing Lists</a>
</li>
           
                        
                    <li class="menuItem">    <a href="http://issues.apache.org/jira/browse/HARMONY">Bug Tracker</a>
</li>
           
                        
                    <li class="menuItem">    <a href="../../related.html">Other Projects</a>
</li>
           
                        
        
        </ul>
            <p class="menuItem"><strong>Development</strong></p>
        <ul>
                    <li class="menuItem">    <a href="../../svn.html">Source Code</a>
</li>
           
                        
                    <li class="menuItem">    <a href="../../quickhelp_contributors.html">Getting Started</a>
</li>
           
                        
                    <li class="menuItem">    <a href="../../roadmap.html">Project Roadmap</a>
</li>
           
                        
                    <li class="menuItem">    <a href="../../issue_resolution_guideline.html">Resolution Guideline</a>
</li>
           
                        
                    <li class="menuItem">    <a href="../../performance.html">Performance</a>
</li>
           
                        
        
        </ul>
            <p class="menuItem"><strong>Documentation</strong></p>
        <ul>
                    <li class="menuItem">    <a href="../../sitemap.html">Sitemap</a>
</li>
           
                        
                    <li class="menuItem">    <a href="http://wiki.apache.org/harmony">Wiki</a>
</li>
           
                        
                    <li class="menuItem">    <a href="../../hdk.html">HDK</a>
</li>
           
                        
                    <li class="menuItem">    <a href="../../subcomponents/drlvm/index.html">DRLVM</a>
</li>
           
                        
                    <li class="menuItem">    <a href="../../subcomponents/classlibrary/index.html">Class Library</a>
</li>
           
                        
                    <li class="menuItem">    <a href="../../subcomponents/buildtest/index.html">Build-test Framework</a>
</li>
           
                        
        
        </ul>
                        </td>
                    <td width="80%" valign="top"><a name="top"></a>
                                                                    <h1>
      <a name="Compatibility goals in the Apache Harmony Class Library">Compatibility goals in the Apache Harmony Class Library</a>
    </h1>
                        <p>
		<big><em>The following guidelines are currently PROPOSED and being discussed on the
		development mailing list <code>dev@harmony.apache.org</code>.  Please
		direct comments and questions there.</em></big>
	</p>
                                <p>
		The Harmony project class library ("<b>classlib</b>") effort is committed
		to producing a set of class library code that not only Java compliant but is also
		compatible with existing Java implementations.
		This page describes the class library code guidelines for ensuring that compatibility.
	</p>
                                    
    <h2>
        <a name="The "Reference Implementation"">The "Reference Implementation"</a>
    </h2>
      
                        <a name="referenceImpl" />
                                <p>
		The Harmony project
		'<a href="http://harmony.apache.org/subcomponents/classlibrary">classlib</a>'
		effort is producing a set of class library code that is compatible with
		<a href="http://java.sun.com/j2se/1.5.0/docs/api/index.html">the Java SE 5.0 API
		specification</a>.
	</p>
                                <p>
		At times (discussed below) it is necessary to augment the specification based on the
		behavior of the reference implementation (RI) of the Java SE 5.0 specification.  In
		such cases we use <a href="http://java.sun.com/j2se/1.5.0/download.jsp">the latest
		official release of the Java SE 5.0 RI</a>.
	</p>
                                <p>
		We are aware that there are other compliant implementations of Java 5.0 available
		but there is only one reference implementation of the Java specification.
	</p>
                   
                                    
    <h2>
        <a name="General Compatibility Guidelines">General Compatibility Guidelines</a>
    </h2>
      
                        <p>
		The following general guidelines apply when developing class library code for Apache
		Harmony:
		<ul>
			<li><b>Comply with the Java Specification</b>
			<p>
				In the first instance we follow the description of each part of the class
				library given in the <a href="#referenceImpl">Java specification</a>.  To
				the large part, this adequately describes the behavior of the class library
				implementation including methods, exceptions, and serialization.  However,
				where the specification is silent on a particular issue facing the implementor,
				or the described behavior is clearly illogical, then we follow the behavior
				of the reference implementation.
			</p></li>
			<li><b>Follow the Reference Implementation</b>
			<p>
				The Reference Implementation (RI) is used to resolve issues that are not
				adequately addressed in the specification.  In such cases we use the RI as a
				guide to the compliant and expected behavior; however, developers <em>must</em>
				ensure that the behaviour of the RI is determined soley through exercising the
				public Java APIs -- specifically we avoid any notion of reverse engineering or
				exposition of the RI's implementation by exercising non-API types and methods.
				</p>
				<p>
				There are a few occasions where both the specification is quiet on a given
				issue, and the RI exhibits behaviour that we would consider illogical.  In such
				cases we discuss the issue on
				<a href="../../mailing.html">the Harmony developers'
				mailing list</a>, and code the class libraries to do what the development community
				conclude is "the logical thing".
			</p></li>
			<li><b>Do "the Logical Thing"</b>
			<p>
				The final decision about how a piece of code should behave, on those rare occasions
				where the specification and RI do not provide a satisfactory answer, is reached
				by concensus on the Harmony developers' mailing list.  Each issue is debated based
				on it's individual circumstances, but the developers are aware that breaking popular
				applications is invariably not "the logical thing" to do.
				<p>
				</p>
				Once a decision has been made it is documented in the code comments and an issue
				raised in <a href="http://issues.apache.org/jira/browse/HARMONY">the Harmony JIRA issue
				tracking system</a> to record the conclusion.  It should be noted that very few issues
				need to be resolved this way.
			</p></li>
		</ul>
	</p>
                   
                                    
    <h2>
        <a name="Exception-throwing compatibility">Exception-throwing compatibility</a>
    </h2>
      
                        <p>
		There are a number of methods in the Java specification that describe the conditions under
		which exceptions are thrown.  However, in most cases the specification does not describe all possible
		exceptions that may be thrown, the order of exception throwing (i.e. where there are multiple
		conditions that would result in an exception), and so on.
	</p>
                                <p>
		The Harmony class libary code aims to be fully compatible with the Reference Implementation (RI)
		of the Java Specification by matching the exception characteristics of each method.
	</p>
                                <p>
		Harmony
		<b>classlib</b> developers write test cases that deliberately cause exceptions to be thrown
		so that we can match exception behaviour like-for-like.  Harmony class library code throws exceptions 
		of the same runtime class (or a subtype of that runtime class) as the RI, other than
        in cases where the RI throws non-public types whereupon Harmony will throw an exception with the same public supertype.
	</p>
                                <p>
		Generally, we could refer to the following steps.
	<ul>
		<li><b>If RI is compliant with the Java Specification</b>
		<p>
		We shall follow RI's behavior, that is, throws exactly the same exception or a subclass of the exception.
		<ul>
			<li>But there are some cases that RI throws an implementation specific exception, 
			which is not in the Java Specification, we shall throw an equivalent Harmony specific exception, 
			or its superclass in the Java Specification.
			<p><i>
			e.g., If RI throws sun.io.MalformedInputException, 
			we could throw org.apache.harmony.io.MalformedInputException or java.io.CharConversionException.
			</i></p>
			</li>
		</ul>
		</p>
		</li>
		<li><b>If RI is not compliant with the Java Specification</b>
		<p>
		<ul>
		<li>If the Java Specification describes the exceptional situation explicitly, 
		and RI throws different kind of exception or even does not throw any exception, 
		we shall discuss them case by case in harmony-dev mailing list.
			<ul>
				<li>If we decide to follow RI, we will raise an "Non-bug differences from Spec" JIRA.</li>
				<li>If we decide to follow the Java Specification, we will raise an "Non-bug differences from RI" JIRA.</li>
			</ul>
		</li>
		<li>If the Java Specification does NOT describe the exceptional situation explicitly, 
		and RI's behavior is either hard to reproduce or illogical, we shall discuss them case by case.
		And we may decide to:
			<ul>
				<li>Follow RI</li>
				<li>Follow the Java Specification</li>
				<li>Implement the functions in our own way</li>
			</ul>
		</li>
		</ul>
		</p>
		</li>
	</ul>
	</p>
                   
                                    
    <h2>
        <a name="Serialization compatibility">Serialization compatibility</a>
    </h2>
      
                        <p>
		The Harmony class library code aims to be serialization compatible with the reference
		implementation (RI).
	</p>
                                <p>
		The Java Specification describes the serialized form of many Java types.  Where given, <b>classlib</b> will follow
		the specified serialized form.  When the serialized form is <u>not</u> given we will ensure that the
		serialization data is compatible with the RI by ensuring that objects serialized from the RI
		can be read by Harmony's <b>classlib</b> code, and vice versa.
	</p>
                                <p>
		Serialization tests are part
		of our regular test suite and typically rely on having the persistent form of serialized objects
		written from the RI stored alongside our test suite code.
	</p>
                                <p>
		To indicate that we are serialization-compatible we define an explicit Stream Unique Identifier
		(SUID) in each of the Harmony <b>classlib</b> serializable types that is equal to the SUID of
		the corresponding type in the RI.
	</p>
                                <p>
		Where the RI produces a serialized form that cannot be replicated by Harmony (e.g. the RI serialized
		form includes types that are not part of the Java specification) then Harmony cannot be
		serialization compatible with the RI, and will both make a prominent note of such in the relevant
		type's JavaDoc comment, and raise a JIRA issue that describes the incompatibility.
	</p>
                   
                <p><a href="#top">Back to top</a></p>
                    
                                                            </td>
                </tr>

                <!-- FOOTER -->
                <tr><td colspan="2">
                    <hr noshade="" size="1"/>
                </td></tr>
                <tr><td colspan="2">
                    <div class="special"><em>
                    Copyright &#169; 2003-2007, The Apache Software Foundation
                    </em></div>
                </td></tr>
            </table>
        </body>
    </html>
<!-- end the processing -->























