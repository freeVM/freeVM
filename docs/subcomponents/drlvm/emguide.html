<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<!--
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->


<!-- start the processing -->
    <!-- ====================================================================== -->
    <!-- GENERATED FILE, DO NOT EDIT, EDIT THE XML FILE IN xdocs INSTEAD! -->
    <!-- Main Page Section -->
    <!-- ====================================================================== -->
    <html>
        <head>
            <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>

                                                    <meta name="author" value="Harmony Documentation Team">
            <meta name="email" value="harmony-dev@incubator.apache.org">
            
           
            
            
            
            
            
            <title>Apache Harmony - Apache Harmony</title>

                                <link rel="Stylesheet" type="text/css" href="site.css"/>
        </head>

        <body>        
            <table  width="100%" cellspacing="0">
                <!-- TOP IMAGE -->
                <tr>
                    <td align='LEFT'>
                    <table><tr><td>
                    <td>
<a href="http://harmony.apache.org/"><img  src="../../images/harmony-logo-new.png" alt="Apache Harmony" /></a>
</td>
</td>
                    </td></tr></table>
                    </td>
                    <td align='RIGHT'>
<!--                    <a href="http://harmony.apache.org/">
                    <img src="http://harmony.apache.org/images/apache-incubator-logo.png"
                    	alt="Apache Harmony" /></a>                    
-->                    </td>
                </tr>
            </table>
            <table width="100%" cellspacing="4">
                <tr><td colspan="2">
                    <hr noshade="" size="1"/>
                </td></tr>

                <tr>
                    <!-- LEFT SIDE NAVIGATION -->
                    <td class="menuItem" width="20%" nowrap="true">

                    <!-- special ACon Logo - leave here for next time
                    <a href="http://www.us.apachecon.com/">
                        <img src="http://www.apache.org/ads/ApacheCon/240x120-2006-us.gif"
                             alt="ApacheCon US 2006" />
                    </a> -->

                   <!-- regular menu -->

                    
    <!-- ============================================================ -->

                <p class="menuItem"><strong>General</strong></p>
        <ul>
                    <li class="menuItem">    <a href="../../index.html">Home</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="../../license.html">License</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="../../contribution_policy.html">Contribution Policy</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="../../guidelines.html">Project Guidelines</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="http://www.apache.org/">ASF</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="../../downloads.html">Downloads</a>
</li>
            
           
                        
                </ul>
            <p class="menuItem"><strong>Community</strong></p>
        <ul>
                    <li class="menuItem">    <a href="../../get-involved.html">Get Involved</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="../../contributors.html">Committers</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="../../mailing.html">Mailing Lists</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="../../documentation/documentation.html">Documentation</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="../../faq.html">FAQ</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="http://wiki.apache.org/harmony">Wiki</a>
</li>
            
           
                        
                </ul>
            <p class="menuItem"><strong>Development</strong></p>
        <ul>
                    <li class="menuItem">    <a href="../../status.html">How Are We Doing?</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="../../roadmap.html">Road Map / TODO</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="../../svn.html">Source Code</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="http://issues.apache.org/jira/browse/HARMONY">JIRA</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="../../related.html">Other Projects</a>
</li>
            
           
                        
                </ul>
            <p class="menuItem"><strong>Subcomponents</strong></p>
        <ul>
                    <li class="menuItem">    <a href="../../subcomponents/buildtest/index.html">Build-Test Framework</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="../../subcomponents/classlibrary/index.html">Class Library</a>
</li>
            
           
                           <table>
              <tr><td class="menuItem">
                &nbsp;&nbsp;&nbsp;&nbsp;    <a href="../../subcomponents/classlibrary/status.html">Status</a>
                </td></tr>
              </table>
                        
                    <li class="menuItem">    <a href="../../subcomponents/drlvm/index.html">DRLVM</a>
</li>
            
           
                        
                    <li class="menuItem">    <a href="../../subcomponents/jchevm/index.html">JCHEVM</a>
</li>
            
           
                        
                </ul>
                        </td>
                    <td width="80%" valign="top"><a name="top"></a>
                                                                    <h1>
      <a name="Guide to Execution Manager Configuration">Guide to Execution Manager Configuration</a>
    </h1>
                            
    <h2>
        <a name="Contents">Contents</a>
    </h2>
      
                        <ol>
<li><a href="#1. What is EM?">What is EM?</a></li>
<li><a href="#2. EM Configuration File">EM Configuration File</a></li>
<li><a href="#3. EM Tracing Options">EM tracing options</a></li>
<li><a href="#4. More EM Configuration Samples">More EM Configuration Samples</a></li>
</ol>
                   
                                    
    <h2>
        <a name="1. What is EM?">1. What is EM?</a>
    </h2>
      
                        <p>
Execution Manager (EM) is a component in DRLVM that controls 
profile collection and recompilation processes.
<br />
For detailed information on EM can be found, see the 
 <a href="http://svn.apache.org/viewcvs.cgi/*checkout*/incubator/harmony/enhanced/drlvm/trunk/vm/doc/DeveloperGuide.htm#EM">
DRLVM Developers Guide</a>
</p>
                   
                                    
    <h2>
        <a name="2. EM Configuration File">2. EM Configuration File</a>
    </h2>
      
                        <p>
The set of JIT compilers and profile collectors used at run time and their
 relations is stored in the <i>EM configuration file</i>.
During the VM initialization phase, EM uses hard-coded configuration or reads 
it from the config file, if specified. 
<br />
You can use the following command-line option to make EM read its 
configuration from the file:<br />
<code>-Xem:&lt;path to configuration file&gt;</code>
<br />
or   <br />
<code>-Dem.properties=&lt;configuration.file.path&gt;</code>
</p>
                                <p>
The following is a line-by-line description of the default EM configuration. 
These configuration settings can be used as a prototype to create 
new custom EM configuration files.
The default configuration is:
</p>
                                <p><pre>
chains=chain1,chain2

chain1.jits=JET_CLINIT
chain2.jits=JET_DPGO,OPT

chain1.filter=+::&lt;clinit&gt;
chain1.filter=-

JET_CLINIT.file=&lt;path to dll&gt;
JET_DPGO.file=&lt;path to dll&gt;
OPT.file=&lt;path to dll&gt;

JET_DPGO.genProfile=JET_DPGO_PROFILE
JET_DPGO_PROFILE.profilerType=ENTRY_BACKEDGE_PROFILER
OPT.useProfile=JET_DPGO_PROFILE

JET_DPGO_PROFILE. mode=SYNC
JET_DPGO_PROFILE.entryThreshold=10000
JET_DPGO_PROFILE.backedgeThreshold=100000
</pre></p>
                                <p>A line-by-line description of the settings follows. </p>
                                <pre>
chains=chain1,chain2
</pre>
                                <p>
Every EM configuration file must define the <code>chains</code> property 
to indicate sequences of JIT compilers to be used to compile and/or recompile
 a method. In this example, two recompilation chains are set for the system: 
<code>chain1</code> and <code>chain2</code>. EM analyzes chains until it has 
chosen the chain for the method. 
</p>
                                <pre>
chain1.jits=JET_CLINIT
chain2.jits=JET_DPGO,OPT
</pre>
                                <p>
In this case, <code>chain1</code> has one JIT compiler 
<code>JET_CLINIT</code>, and <code>chain2</code> has
 two compilers: <code>JET_DPGO</code> and <code>OPT</code>.
Using these JIT names, EM reads JIT-specific configuration 
and passes the names to JIT instances during initialization. 
A compiler instance can use its name to distinguish between 
its own properties and those of other JITs.  <br />
</p>
                                <p>
<b>Note:</b> Jitrino, the current default DRLVM JIT compiler, 
selects Jitrino.JET (fast, non-optimizing compiler) if the name 
starts with the <code>JET</code> prefix. Otherwise, the JIT 
instance is treated as Jitrino.OPT.
</p>
                                <pre>
chain1.filter=+::&lt;clinit&gt; 
chain1.filter=-
</pre>
                                <p>
Method filters are used to select methods that will be compiled
 by the first JIT in a chain. 
In this example, the first line configures <code>chain1</code> 
to accept all <code>&lt;clinits&gt;</code> methods 
and the second line - to refuse to compile all other methods. <br />
The order of filters for every chain is significant. Chain
 filters can be considered as if-else clauses: <br />
If a filter matches a method, EM stops examining other filters
 and analyzes the first sign in the filter: <br />
<ul>
<li>For a <code>+</code>, EM requests the first JIT in the 
chain to compile the method. </li>
<li>For a <code>-</code>, EM tries the next chain in the list. </li>
</ul>
If no filter has matched the compilation request, EM considers 
that the method is accepted to be compiled by the chain. 
<br />
Here is a format of all currently supported method filters. 
</p>
                                <br />
                                <table>
                        <tr>
                        <td class="TableCell" colspan="" rowspan="" >
    
                
<b>Filter Type</b>

        </td>
                                <td class="TableCell" colspan="" rowspan="" >
    
                
<b>Filter Format   </b>

        </td>
                                <td class="TableCell" colspan="" rowspan="" >
    
                
<b>Filter Examples </b>

        </td>
            </tr>
                                <tr>
                        <td class="TableCell" colspan="" rowspan="" >
    
                
Name filter

        </td>
                                <td class="TableCell" colspan="" rowspan="" >
    
                
&lt;class-name&gt;::&lt;method_name&gt;&lt;signature&gt;

        </td>
                                <td class="TableCell" colspan="" rowspan="" >
    
                
'<i>-</i> rejects all methods.<br />'
'<i>+java/lang</i>' accepts all methods from the .java/lang package.<br />
'<i>+java/lang/Thread::s</i>' accepts all methods of 
java.lang.Thread that starts with the letter 's'.<br />

        </td>
            </tr>
                                <tr>
                        <td class="TableCell" colspan="" rowspan="" >
    
                
Size filter

        </td>
                                <td class="TableCell" colspan="" rowspan="" >
    
                
NUMB or NUM1B..NUM2B

        </td>
                                <td class="TableCell" colspan="" rowspan="" >
    
                
'<i>+10B..100B</i>' accepts all methods of bytecode size in range of 
[10..100].<br />
'<i>-20B</i>' rejects all methods of bytecode size equal to 20. 

        </td>
            </tr>
                                <tr>
                        <td class="TableCell" colspan="" rowspan="" >
    
                
Compile-num filter

        </td>
                                <td class="TableCell" colspan="" rowspan="" >
    
                
NUM or NUM..NUM

        </td>
                                <td class="TableCell" colspan="" rowspan="" >
    
                
'<i>+1..1000</i>' accepts all methods from 1 to 1000 (inclusive).<br />
'<i>-800</i>' rejects to compile method that is compiled by number 800. 

        </td>
            </tr>
            </table>
                                <br />
                                <p>
<b>Note:</b> The sequential method number could be changed from run 
to run in multithreaded environments. 
</p>
                                <p><pre>
JET_CLINIT.file=&lt;path to dll&gt;
JET_DPGO.file=&lt;path to dll&gt;
OPT.file=&lt;path to dll&gt;
</pre></p>
                                <p>
For every JIT, the configuration file must define the location of the library
 file location.
Multiple JIT compilers can be associated with the same library. 
For example, all paths can point to the same jit.dll file. 
</p>
                                <p><pre>
JET_DPGO.genProfile=JET_DPGO_PROFILE
JET_DPGO_PROFILE.profilerType=ENTRY_BACKEDGE_PROFILER
OPT.useProfile=JET_DPGO_PROFILE
</pre></p>
                                <p>
These settings define profile collection and recompilation event 
configuration for two JIT compilers: <code>JET_DPGO</code> 
and <code>OPT</code>.
The first line configures <code>JET_DPGO</code> to generate a 
profile <code>JET_DPGO_PROFILE</code>, 
with the type of associated profile collector specified in the 
second line. <code>ENTRY_BACKEDGE_PROFILER</code> 
is the built-in DRL EM profile collector type. 
In the third line, the <code>OPT</code> compiler is configured 
to use the new profile.
After reading these configuration settings, the execution 
manager does the following: <br />
<ol>
<li>Instantiates the profile collector of the type 
<code>ENTRY_BACKEDGE_PROFILER</code>. </li>
<li>Checks whether the <code>JET_DPGO</code> JIT can generate 
method profiles of this type; if so, requests the JIT to enable
 profile generation. </li>
<li>Checks whether the <code>OPT JIT</code> can use method 
profiles of this type. </li>
<li>Registers the profile collector as active. </li>
</ol>
</p>
                                <p><pre>
JET_DPGO_PROFILE. mode=SYNC
JET_DPGO_PROFILE.entryThreshold=10000
JET_DPGO_PROFILE.backedgeThreshold=100000 
</pre></p>
                                <p>
The last 4 lines contain the configuration of the <code>JET_DPGO_PROFILE</code>
 profiler. These properties are specific for every profile collector type. 
The first option runs entry-backedge profile mode in the SYNC mode: counters 
check is done during the code execution. Use  ASYNC to run counters 
checking in a separate thread. The last 2 options set the profile readiness 
threshold. Once the profile is ready, EM dispatches the method for 
recompilation with the next JIT in the current chain.
</p>
                   
                                    
    <h2>
        <a name="3. EM Tracing Options">3. EM Tracing Options</a>
    </h2>
      
                        <p>
Use the following command-line options to trace EM events:
<br />
<code>-verbose:em</code> dumps all EM events.<br />
<code>-verbose:em.JIT_NAME</code> dumps only JIT named 
"<code>JIT_NAME</code>" related events. <br />
<code>-verbose:em.profiler.PROFILER_NAME</code> dumps only profiler
 "<code>PROFILER_NAME</code>" related events.<br />
</p>
                                <p class="example">
    Example
  </p>
                                <p class="exampletext">
For the default EM configuration file, 
<br /><code>
-verbose:em.OPT 
</code><br /> dumps all methods names that are compiled with 
Jitrino.OPT. According to the configuration details, these methods 
are hot methods.
</p>
                                <p class="exampletext">Alternatively, you can get almost the same information by using 
the following: 
<br /><code>
-verbose:em.profiler.JET_DPGO_PROFILE 
</code><br /> additionally dumps information about hot method profiles.
</p>
                                <p class="example">Examples of output:</p>
                                <br />
                                <code>
C:\tools\decapo&gt;c:\tools\harmony0706\bin\java.exe  -verbose:em.OPT -jar dacapo-beta051009.jar xalan<br />
EM: recompile start:[OPT n=1] java/io/ByteArrayOutputStream::write(I)V<br />
EM: recompile done:[OPT n=1] java/io/ByteArrayOutputStream::write(I)V<br />
EM: recompile start:[OPT n=2] java/lang/String::hashCode()I<br />
EM: recompile done:[OPT n=2] java/lang/String::hashCode()I<br />
...<br />
C:\tools\decapo&gt;c:\tools\harmony0706\bin\java.exe  -verbose:em.profiler.JET_DPGO_PROFILE -jar dacapo-beta051009.jar xalan<br />
EM: entry-backedge profiler intialized: JET_DPGO_PROFILE entry threshold:10000 backedge threshold:100000 mode:SYNC<br />
EM: profiler[JET_DPGO_PROFILE] profile is ready [e:10000 b:0] java/io/ByteArrayOutputStream::write(I)V<br />
EM: profiler[JET_DPGO_PROFILE] profile is ready [e:10000 b:59575] java/lang/String::hashCode()I<br />
EM: profiler[JET_DPGO_PROFILE] profile is ready [e:10000 b:0] java/lang/String::length()I<br />
EM: profiler[JET_DPGO_PROFILE] profile is ready [e:10000 b:0] java/lang/String::charAt(I)C<br />
EM: profiler[JET_DPGO_PROFILE] profile is ready [e:10000 b:0] java/nio/charset/Charset::isLetter(C)Z<br />
EM: profiler[JET_DPGO_PROFILE] profile is ready [e:10000 b:0] java/nio/charset/Charset::isDigit(C)Z<br />
EM: profiler[JET_DPGO_PROFILE] profile is ready [e:10000 b:0] java/nio/Buffer::remaining()I<br />
EM: profiler[JET_DPGO_PROFILE] profile is ready [e:10000 b:0] java/util/HashMap::getModuloHash(Ljava/lang/Object;)I<br />
...  <br />
</code>
                                <br />
                   
                                    
    <h2>
        <a name="4. More EM Configuration Samples">4. More EM Configuration Samples</a>
    </h2>
      
                        <p>
    DRLVM has several EM configurations supplied in the following files:
    <code>client.emconf</code> (the default), <code>opt.emconf</code>, <code>jet.emconf</code>,
    <code>server.emconf</code> and <code>server_static.emconf</code>.<br />
    The <code>-Xem:opt</code>, <code>-Xem:jet</code> and <code>-Xem:server_static</code>
    configurations are almost identical and rely on the Jitrino
    JIT naming convention. This way, any JIT instance with the <code>JET</code>
    prefix in the name is a Jitrino.JET instance. <br />
    Another difference in these configurations are options passed to the JIT compiler.
  </p>
                                <p><i>These configurations have only one JIT and no profile collection or recompilation.</i></p>
                                <p><b>
  <code>-Xem:jet</code> - the baseline compiler mode configuration</b></p>
                                <p><pre>
chains=chain1
chain1.jits=JET
JET.file=&lt;path to dll&gt;
</pre></p>
                                <p><b>
  <code>-Xem:opt</code> - the client-static mode configuration</b></p>
                                <p><pre>
chains=chain1
chain1.jits=CS_OPT
OPT.file=&lt;path to dll&gt;
</pre></p>
                                <p><b>
  <code>-Xem:server_static</code> - the server-static mode configuration</b></p>
                                <p><pre>
chains=chain1
chain1.jits=SS_OPT
OPT.file=&lt;path to dll&gt;
</pre></p>
                                <br />
                                <p><i>These configurations use recompilation and collect profiles.</i></p>
                                <p><b>
  <code>-Xem:client</code> - the default configuration, or client dynamic</b></p>
                                <p><pre>
chains=chain1,chain2
chain1.jits=JET_CLINIT
chain2.jits=JET_DPGO,CD_OPT


# JET_CLINIT compiles only &lt;clinit&gt; methods, all other methods compiled with JET_DPGO 
# which does entry/backedge instrumentation

chain1.filter=+::&lt;clinit&gt;
chain1.filter=-

JET_CLINIT.file=&lt;path to dll&gt;
JET_DPGO.file=&lt;path to dll&gt;
CD_OPT.file=&lt;path to dll&gt;

#Confuguration of profile collector and recompilation
JET_DPGO.genProfile=EB_PROF
EB_PROF.profilerType=EB_PROFILER
CD_OPT.useProfile=EB_PROF


EB_PROF.mode=SYNC
EB_PROF.entryThreshold=10000
EB_PROF.backedgeThreshold=100000
</pre></p>
                                <p><b>
  <code>-Xem:server</code> - the server mode configuration, or server dynamic</b></p>
                                <p><pre>
chains=chain1,chain2
chain1.jits=JET_CLINIT
chain2.jits=SD1_OPT,SD2_OPT

chain1.filter=+::&lt;clinit&gt;
chain1.filter=-

JET_CLINIT.file=&lt;path to dll&gt;
SD1_OPT.file=&lt;path to dll&gt;
SD2_OPT.file=&lt;path to dll&gt;

# Edge profiler and recompilation parameters
EDGE_PROF.profilerType=EDGE_PROFILER
EDGE_PROF.entryThreshold=40000
EDGE_PROF.backedgeThreshold=150000
EDGE_PROF.tbsTimeout=10
EDGE_PROF.tbsInitialTimeout=0

SD1_OPT.genProfile=EDGE_PROF
SD2_OPT.useProfile=EDGE_PROF
</pre></p>
                                <p class="note">Note</p>
                                <p class="notetext">To run VM in the intereter mode, use the <code>-Xint</code> 
command-line option to override any other EM settings. Currently, DRLVM does
 not support the mixed mode of the JIT compiler plus interpreter.
</p>
                   
                <p><a href="#top">Back to top</a></p>
                    
                                                            </td>
                </tr>

                <!-- FOOTER -->
                <tr><td colspan="2">
                    <hr noshade="" size="1"/>
                </td></tr>
                <tr><td colspan="2">
                    <div class="special"><em>
                    Copyright &#169; 2003-2006, The Apache Software Foundation
                    </em></div>
                </td></tr>
            </table>
        </body>
    </html>
<!-- end the processing -->






















