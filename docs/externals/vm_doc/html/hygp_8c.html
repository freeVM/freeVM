<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Harmony Class Library Porting: modules/portlib/src/main/native/port/shared/hygp.c File Reference</title>
<link href="hydoxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.4 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<h1>modules/portlib/src/main/native/port/shared/hygp.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Provides platform-neutral signal handling functions. 
<p>
The <a class="el" href="hygp_8c.html#985d194bb38bd85fda8356d2d709d182">hygp_register_handler</a> function is partially dependent on internal VM structures, and must be called with NULL as a third (userData) parameter. <br>
<br>
 
<p>
<code>#include &quot;<a class="el" href="hyport_8h.html">hyport.h</a>&quot;</code><br>
<code>#include &quot;hycomp.h&quot;</code><br>
<code>#include &quot;gp.h&quot;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">UDATA VMCALL&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="hygp_8c.html#4e6e359ed400f2b9ff9e5aaa11ef2ec9">hygp_protect</a> (struct <a class="el" href="structHyPortLibrary.html">HyPortLibrary</a> *portLibrary, protected_fn fn, void *arg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Kicks off the new thread by calling the function provided in protected_fn fn.  <a href="#4e6e359ed400f2b9ff9e5aaa11ef2ec9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void VMCALL&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="hygp_8c.html#985d194bb38bd85fda8356d2d709d182">hygp_register_handler</a> (struct <a class="el" href="structHyPortLibrary.html">HyPortLibrary</a> *portLibrary, handler_fn fn, void *aUserData)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sets the function that is responsible for preserving/outputting the state of the vm and initiating a graceful shutdown resulting from a gp.  <a href="#985d194bb38bd85fda8356d2d709d182"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">U_32 VMCALL&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="hygp_8c.html#a64060f367b0f3f8952d49b3ecc6ae6d">hygp_info</a> (struct <a class="el" href="structHyPortLibrary.html">HyPortLibrary</a> *portLibrary, void *info, U_32 category, I_32 index, const char **name, void **value)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Provides the name and value, specified by category/index of the gp information in info.  <a href="#a64060f367b0f3f8952d49b3ecc6ae6d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">U_32 VMCALL&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="hygp_8c.html#81c5ceb80f4e74142260ba63f52ea988">hygp_info_count</a> (struct <a class="el" href="structHyPortLibrary.html">HyPortLibrary</a> *portLibrary, void *info, U_32 category)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the number of items that exist in the category specified, or zero if the category is undefined.  <a href="#81c5ceb80f4e74142260ba63f52ea988"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void VMCALL&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="hygp_8c.html#022c3820f5fda71cb0bce1851063f051">hygp_shutdown</a> (struct <a class="el" href="structHyPortLibrary.html">HyPortLibrary</a> *portLibrary)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PortLibrary shutdown.  <a href="#022c3820f5fda71cb0bce1851063f051"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">I_32 VMCALL&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="hygp_8c.html#6d7c1c48bf066779c961af44638dd6af">hygp_startup</a> (struct <a class="el" href="structHyPortLibrary.html">HyPortLibrary</a> *portLibrary)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PortLibrary startup.  <a href="#6d7c1c48bf066779c961af44638dd6af"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a64060f367b0f3f8952d49b3ecc6ae6d"></a><!-- doxytag: member="hygp.c::hygp_info" ref="a64060f367b0f3f8952d49b3ecc6ae6d" args="(struct HyPortLibrary *portLibrary, void *info, U_32 category, I_32 index, const char **name, void **value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U_32 VMCALL hygp_info           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structHyPortLibrary.html">HyPortLibrary</a> *&nbsp;</td>
          <td class="paramname"> <em>portLibrary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U_32&nbsp;</td>
          <td class="paramname"> <em>category</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">I_32&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Provides the name and value, specified by category/index of the gp information in info. 
<p>
Returns the kind of information found at category/index specified, or undefined if the category/index are invalid. The number of items in the category specified must equal the count <a class="el" href="hygp_8c.html#81c5ceb80f4e74142260ba63f52ea988">hygp_info_count</a> returns for that category.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>portLibrary</em>&nbsp;</td><td>The port library </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>info</em>&nbsp;</td><td>struct containing all available signal information. Normally includes register values, name of module where crash occured and its base address. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>category</em>&nbsp;</td><td>the category of signal information that you are querying. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>index</em>&nbsp;</td><td>the index of the item in the specified category. The number of items for each category are defined in the sourceTemplate. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>name</em>&nbsp;</td><td>the name of the item at the specified index. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>value</em>&nbsp;</td><td>the value of the item at the specified index</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the kind of info at the specified index. For example, this allows the caller to determine whether the item placed in **value corresponds to a 32/64-bit integer or a pointer to a string.</dd></dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>The program counter and module name also have negative indexes as defined by HYGP_CONTROL_PC and HYGP_MODULE_NAME respectively. <p>
Above allows the handler function registered in <a class="el" href="hygp_8c.html#985d194bb38bd85fda8356d2d709d182">hygp_register_handler</a> to distinguish (and use) them from the other gp items. <p>
The caller is responsible for allocating and freeing any buffers used by **name, **value. </dd></dl>

</div>
</div><p>
<a class="anchor" name="81c5ceb80f4e74142260ba63f52ea988"></a><!-- doxytag: member="hygp.c::hygp_info_count" ref="81c5ceb80f4e74142260ba63f52ea988" args="(struct HyPortLibrary *portLibrary, void *info, U_32 category)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U_32 VMCALL hygp_info_count           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structHyPortLibrary.html">HyPortLibrary</a> *&nbsp;</td>
          <td class="paramname"> <em>portLibrary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U_32&nbsp;</td>
          <td class="paramname"> <em>category</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns the number of items that exist in the category specified, or zero if the category is undefined. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>portLibrary</em>&nbsp;</td><td>The port library </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>info</em>&nbsp;</td><td>struct containing all available signal information. Normally includes register values, name of module where crash occured and its base address. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>category</em>&nbsp;</td><td>the category in which we want to find the number of items that exist.</td></tr>
  </table>
</dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Return value must agree with the number of items that <a class="el" href="hygp_8c.html#a64060f367b0f3f8952d49b3ecc6ae6d">hygp_info</a> makes available for the category specified. </dd></dl>

</div>
</div><p>
<a class="anchor" name="4e6e359ed400f2b9ff9e5aaa11ef2ec9"></a><!-- doxytag: member="hygp.c::hygp_protect" ref="4e6e359ed400f2b9ff9e5aaa11ef2ec9" args="(struct HyPortLibrary *portLibrary, protected_fn fn, void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UDATA VMCALL hygp_protect           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structHyPortLibrary.html">HyPortLibrary</a> *&nbsp;</td>
          <td class="paramname"> <em>portLibrary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">protected_fn&nbsp;</td>
          <td class="paramname"> <em>fn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Kicks off the new thread by calling the function provided in protected_fn fn. 
<p>
All threads spawned by the vm start here and all OS signals that will be handled by fn must be registered to the OS here. Upon receiving a signal from the OS, fn is responsible for calling the function specified in <a class="el" href="hygp_8c.html#985d194bb38bd85fda8356d2d709d182">hygp_register_handler</a> if it is determined that a shutdown is required.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>portLibrary</em>&nbsp;</td><td>The port library </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fn</em>&nbsp;</td><td>the function that will be used to kick off the thread </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>arg</em>&nbsp;</td><td>arguments to protected_fn fn</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the return value of the function provided in fn</dd></dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>it is a good idea to save the portLibrary in case a registered exception handler cannot be found </dd></dl>

</div>
</div><p>
<a class="anchor" name="985d194bb38bd85fda8356d2d709d182"></a><!-- doxytag: member="hygp.c::hygp_register_handler" ref="985d194bb38bd85fda8356d2d709d182" args="(struct HyPortLibrary *portLibrary, handler_fn fn, void *aUserData)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VMCALL hygp_register_handler           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structHyPortLibrary.html">HyPortLibrary</a> *&nbsp;</td>
          <td class="paramname"> <em>portLibrary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">handler_fn&nbsp;</td>
          <td class="paramname"> <em>fn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>aUserData</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Sets the function that is responsible for preserving/outputting the state of the vm and initiating a graceful shutdown resulting from a gp. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>portLibrary</em>&nbsp;</td><td>The port library </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fn</em>&nbsp;</td><td>function responsible for preserving/outputting the state of the vm and initiating a graceful shutdown resulting from a gp. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>aUserData</em>&nbsp;</td><td>The HyJavaVM or NULL for non-HY consumers.</td></tr>
  </table>
</dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>vmGPHandler in gphandle.c is currently the only function used for handling gps. <p>
fn is not called by the OS but by the gp handler function specified in the call to <a class="el" href="hygp_8c.html#4e6e359ed400f2b9ff9e5aaa11ef2ec9">hygp_protect</a> gp module <p>
above occurs after the OS has passed a signal along to us and it is determined that a shutdown is required. </dd></dl>

</div>
</div><p>
<a class="anchor" name="022c3820f5fda71cb0bce1851063f051"></a><!-- doxytag: member="hygp.c::hygp_shutdown" ref="022c3820f5fda71cb0bce1851063f051" args="(struct HyPortLibrary *portLibrary)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VMCALL hygp_shutdown           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structHyPortLibrary.html">HyPortLibrary</a> *&nbsp;</td>
          <td class="paramname"> <em>portLibrary</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
PortLibrary shutdown. 
<p>
This function is called during shutdown of the portLibrary. Any resources that were created by <a class="el" href="hygp_8c.html#6d7c1c48bf066779c961af44638dd6af">hygp_startup</a> should be destroyed here.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>portLibrary</em>&nbsp;</td><td>The port library</td></tr>
  </table>
</dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Most implementations will be empty. </dd></dl>

</div>
</div><p>
<a class="anchor" name="6d7c1c48bf066779c961af44638dd6af"></a><!-- doxytag: member="hygp.c::hygp_startup" ref="6d7c1c48bf066779c961af44638dd6af" args="(struct HyPortLibrary *portLibrary)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">I_32 VMCALL hygp_startup           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structHyPortLibrary.html">HyPortLibrary</a> *&nbsp;</td>
          <td class="paramname"> <em>portLibrary</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
PortLibrary startup. 
<p>
This function is called during startup of the portLibrary. Any resources that are required for the shared library operation may be created here. All resources created here should be destroyed in <a class="el" href="hygp_8c.html#022c3820f5fda71cb0bce1851063f051">hygp_shutdown</a>.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>portLibrary</em>&nbsp;</td><td>The port library</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success, negative error code on failure. Error code values returned are <ul>
<li>HYPORT_ERROR_STARTUP_GP</li>
</ul>
</dd></dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Most implementations will simply return success. </dd></dl>

</div>
</div><p>
<hr size="1">
<address style="text-align: center;">
  <small>
    <p>Genereated on Tue Dec 9 14:12:59 2008 by Doxygen.</p>
    <p>(c) Copyright 2005, 2008 The Apache Software Foundation or its licensors, as applicable. </p>
  </small>
</address>
</body>
</html>
